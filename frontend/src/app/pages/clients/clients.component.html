<app-navbar></app-navbar>

<div class="transactions-container">
  <input
    type="text"
    [placeholder]="getTranslation('transactions.searchClient')"
    [(ngModel)]="searchTerm"
    class="form-control mb-3"
  />

  <table>
    <thead>
      <tr>
        <th>{{ getTranslation('transactions.clientName') }}</th>
        <th>{{ getTranslation('transactions.date') }}</th>
        <th>{{ getTranslation('transactions.time') }}</th>
        <th>{{ getTranslation('transactions.serviceType') }}</th>
        <th>{{ getTranslation('transactions.price') }}</th>
        <th>{{ getTranslation('transactions.percentageFor') }}</th>
        <th>{{ getTranslation('transactions.percentageValue') }}</th>
      </tr>
    </thead>

    <tbody>
<tr *ngFor="let transaction of filteredTransactions | slice:(page-1)*pageSize:(page*pageSize)"[class.shake]="deleteMode"[class.shake-row]="deleteMode">
  <td [attr.data-label]="getTranslation('transactions.clientName')">{{ transaction.clientName }}</td>
  <td [attr.data-label]="getTranslation('transactions.date')">{{ transaction.date | date:'yyyy-MM-dd' }}</td>
  <td [attr.data-label]="getTranslation('transactions.time')">{{ transaction.time }}</td>
  <td [attr.data-label]="getTranslation('transactions.serviceType')">{{ getServiceNameById(transaction.serviceId) }}</td>
  <td [attr.data-label]="getTranslation('transactions.price')">{{ transaction.amountPaid | currency:'ILS':'symbol':'1.0-0':'he-IL' }}</td>
  <td [attr.data-label]="getTranslation('transactions.percentageFor')">{{ getStaffNameById(transaction.percentageRecipientId) || '-' }}</td>
  <td [attr.data-label]="getTranslation('transactions.percentageValue')">{{ transaction.percentageGiven }}%</td>
  
  <!-- Delete icon shown only in delete mode and on hover -->
  <td class="delete-cell" *ngIf="deleteMode">
    <span class="delete-x" (click)="deleteTransaction(transaction.id)">‚ùå</span>
  </td>
</tr>

      <tr>
        <td [attr.data-label]="getTranslation('transactions.clientName')">
          <input [placeholder]="getTranslation('transactions.clientName')" [(ngModel)]="newTransaction.clientName">
        </td>
        <td [attr.data-label]="getTranslation('transactions.date')">
          <input type="date" [(ngModel)]="newTransaction.date">
        </td>
        <td [attr.data-label]="getTranslation('transactions.time')">
          <input type="time" [(ngModel)]="newTransaction.time">
        </td>
        <td [attr.data-label]="getTranslation('transactions.serviceType')">
          <select [(ngModel)]="newTransaction.serviceId" (change)="onServiceChange()">
            <option value="" disabled selected>{{ getTranslation('transactions.selectService') }}</option>
            <option *ngFor="let service of services" [value]="service.id">{{ service.name }}</option>
          </select>
        </td>
        <td [attr.data-label]="getTranslation('transactions.price')">
          <input type="number" [placeholder]="getTranslation('transactions.amountPaid')" [(ngModel)]="newTransaction.amountPaid">
        </td>
        <td [attr.data-label]="getTranslation('transactions.percentageFor')">
          <select [(ngModel)]="newTransaction.percentageRecipientId">
            <option value="" disabled selected>{{ getTranslation('transactions.selectStaff') }}</option>
            <option *ngFor="let staffMember of staff" [value]="staffMember.id">{{ staffMember.name }}</option>
          </select>
        </td>
        <td [attr.data-label]="getTranslation('transactions.percentageValue')">
          <input type="number" [placeholder]="'%'" [(ngModel)]="newTransaction.percentageGiven">
        </td>
      </tr>
    </tbody>
  </table>

  <div class="pagination">
    <button (click)="page = page - 1" [disabled]="page === 1">{{ getTranslation('pagination.prev') }}</button>
    <span>
      {{ getTranslation('pagination.page') }} {{ page }} {{ getTranslation('pagination.of') }} {{ Math.ceil(transactions.length / pageSize) }}
    </span>
    <button (click)="page = page + 1" [disabled]="page >= Math.ceil(transactions.length / pageSize)">{{ getTranslation('pagination.next') }}</button>
  </div>

<div class="actions">
  <button class="add-btn" (click)="addTransaction()">
    {{ getTranslation('transactions.addTransaction') }}
  </button>

  <button class="delete-btn" (click)="toggleDeleteMode()">
    {{ deleteMode ? getTranslation('transactions.exitDeleteMode') : getTranslation('transactions.deleteTransaction') }}
  </button>
</div>
</div>

<div *ngIf="getLoggedInStaffName() === 'dima'" class="katia-work-section p-4 border rounded shadow mt-6">
  <app-katia-work></app-katia-work>
</div>
